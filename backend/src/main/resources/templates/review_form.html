<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Form (Thymeleaf)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-bottom: 5px; }
        input[type="number"], textarea { width: 300px; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #response { margin-top: 20px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Write a Review</h1>

    <form id="reviewForm">
        <!-- Mentor ID와 Reservation ID 필드 제거 -->

        <label for="rating">Rating (1-5):</label>
        <input type="number" id="rating" name="rating" min="1" max="5" value="5" required><br>

        <label for="content">Content:</label>
        <textarea id="content" name="content" rows="5" required>This is a great mentor!</textarea><br>

        <button type="submit">Submit Review</button>
    </form>

    <div id="response"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // URL에서 mentorId 추출
            const urlParams = new URLSearchParams(window.location.search);
            const mentorId = urlParams.get('mentorId');

            // 임시 reservationId (실제 구현에서는 백엔드에서 처리되어야 함)
            const reservationId = 1; // 임시 값

            document.getElementById('reviewForm').addEventListener('submit', async function(event) {
                event.preventDefault();

                // mentorId와 reservationId는 폼에서 직접 가져오지 않고 URL 및 임시 값 사용
                const rating = document.getElementById('rating').value;
                const content = document.getElementById('content').value;

                const reviewData = {
                    mentorId: parseInt(mentorId),
                    reservationId: parseInt(reservationId),
                    rating: parseInt(rating),
                    content: content
                };

                try {
                    const response = await fetch('/api/reviews', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(reviewData)
                    });

                    const responseDiv = document.getElementById('response');
                    if (response.ok) {
                        const data = await response.json();
                        responseDiv.style.color = 'green';
                        responseDiv.innerHTML = `Review submitted successfully! <pre>${JSON.stringify(data, null, 2)}</pre>`;
                    } else {
                        const errorText = await response.text();
                        responseDiv.style.color = 'red';
                        responseDiv.innerHTML = `Error submitting review: ${response.status} ${response.statusText}<br><pre>${errorText}</pre>`;
                    }
                } catch (error) {
                    const responseDiv = document.getElementById('response');
                    responseDiv.style.color = 'red';
                    responseDiv.innerHTML = `Network error: ${error.message}`;
                }
            });
        });
    </script>
</body>
</html>